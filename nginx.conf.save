upstream ipfs {
    server 20.205.136.98:8080;
    server 20.40.43.20:8080;
}
upstream ipfswrite {
    server 20.205.136.98:5001;
    server 20.40.43.20:5001;

upstream cluster {
    server 20.205.136.98:9094;
    server 20.40.43.20:9094;
}

server {
    listen 80;
    server_name localhost;
    satisty all;
    allow 74.226.196.99;
    deny all;

    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header Content-Security-Policy "default-src 'self';" always;
    add_header X-XSS-Protection "1; mode=block";
    add_header Referrer-Policy "no-referrer";
    add_header X-Content-Type-Options "nosniff";
    add_header X-Frame-Options "DENY";
    add_header Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), microphone=(), payment=(), usb=()";
    location /ipfs/ {
        proxy_pass http://ipfs/;
        rewrite ^/ipfs?$ /$request_uri break;
    }

    location /ipfswrite/ {
        proxy_pass http://ipfswrite/;
        rewrite ^/ipfswrite?$ /$request_uri break;
       
        auth_basic "Administratorâ€™s Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
        
    location /cluster/ {
        proxy_pass http://cluster/;
        rewrite ^/cluster?$ /$request_uri break;
    }

    location / {
    default_type text/html;
    return 200 "use /ipfs/ to use ipfs api endpoint.\n use /cluster/ to use ipfs cluster api endpoint";
    }
}
